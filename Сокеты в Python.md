Сокет - это низкоуровненая абстракция отправки и получения данных по сети. Именно с ее помощью производится обмен данными между клиентами и серверами. 

По умолчанию сокеты являются блокирующими. Другими словами, на все время ожидания ответа от сервера приложение приостанавливается или блокируется. Следовательно, оно ничего не может делать, пока не придут данные или не возникнет ошибка (например, тайм-аут). 

В соответствии с приведенной ниже схема, в сокет записываются данные, затем эти данные отправляются по сети на сервер - сервер отправляет в ответ байты в наш сокет, и затем эти байты читаются. 
![[Pasted image 20230308134738.png]]

На уровне операционной системы эта блокировка ни к чему. Соответственно, сокеты могут работать в неблокирующем режиме - операционная система уведомляет о том, что байты в сокете получены, и тогда можно приступить к операции их чтения. В разных ОС используются различные системы уведомления о работе сокетов, но библиотека asyncio абстрагирует эти различия. 
![[Pasted image 20230308135231.png]]

В целом, неблокирующие сокеты можно писать и в синхронном стиле. Тем не менее, для получения подключений обычно используется бесконечный цикл. И по техническим причинам, сокету приходится слушать байты до того, как на них было что-либо отправлено (такие ситуации могут происходить). Из-за этого возникает исключение, которое необходимо обрабатывать. В совокупности с бесконечным с циклом, это приводит к маскимальной загрузке процессора (ядра), поэтому такое решение необходимо назвать неэффективным. 

Поэтому эффективнее использовать систему наблюдения за сокетами на уровне ОС. В данном процессе практически не участвует процессор, т.к. он происходит на аппаратном уровне. Суть в том, что мы передаем ей сокеты, за событиями которых необходимо наблюдать, а ОС в ответ сообщает о том, когда в одном из них появляются данные. Возможность взаимодействия с данной системой реализована на python в рамках библиотеки selectors. 

___
Relations: [[asyncio Python]] 
Tags: #theory 
References: [[Asyncio (книга)]] 
Query: 