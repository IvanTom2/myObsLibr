Для асинхронных подключений к базе данных нужно использовать соответствующие асинхронные модули. Обычные модули для работы с БД являются блокирующими. 

Для работы с PostgreSQL используется `asyncpg`. 
Подключение выполняется через `connection`. 
Для выполнения SQL запроса используется `connection.execute`. Важно помнить, что каждый запрос является сопрограммой и его необходимо ожидать.

Кроме того, нужно помнить о том, что ***некоторые команды необходимо выполнять синхронно***. Это можно сделать, например, через цикл `for`. Примером таких команд может быть создание таблиц в базе данных, так как таблицы могут быть зависимы друг от друга за счет ключей. 

При работе с БД стоит помнить о том, что не получится начать выполнение нескольких сопрограмм без соответствующего пула сокетов. Сокет, начав выполнять задачу, будет занят. Это значит, что мы не сможет создать несколько задач и запустить их, например, через `asyncio.gather`. Для этого потребуется пул подлючений - это массив закешированных подключений. Они кешируются, потому что создание подключения обходится достаточно дорого.
Если в пуле подключений имеется два подключения, то начнут выполняться две задачи и оставшиеся будут ждать освобождения подключений. 



___
```
import asyncio
import asyncpg

CREATE_BRAND_TABLE = """
	CREATE TABLE IF NOT EXISTS brand(
	brand_id SERIAL PRIMARY KEY,
	brand_name TEXT NOT NULL
);"""

async def main():
    connection: asyncpg.connection.Connection = await asyncpg.connect(
        host="127.0.0.1",
        port=5432,
        user="admin",
        database="asyncpg_test",
        password="Parad228Hurt",
    )

    version = connection.get_server_version()
	await connection.execute(CREATE_BRAND_TABLE)

    await connection.close()


if __name__ == "__main__":
    asyncio.run(main())

```
___

Relations: [[asyncio Python]] 
Tags: #code
References: [[Asyncio (книга)]] 
Query: 