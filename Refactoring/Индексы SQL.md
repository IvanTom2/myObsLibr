Существует множество типов индексов. Но по своему смыслу индекс SQL - это структура данных, которая:
1. Избыточна: индекс можно удалить без потери данных
2. Невидима для приложения
3. Предназначена для ускорения выбора данных по определенным критериям

Индексы должны быть с низкой селективностью. Это значит, что на один индекс должно приходиться как меньше строк данных таблицы (столбца). Наиболее эффективные индексы - ***уникальные***.

Первичный ключ или ограничение уникальности (UNIQUE) создают уникальные индексы автоматически (для поддержки ПК и ограничений). 

В тоже время, внешний ключ не подразумевает наличие индекса в дочерней таблице (т.е. в той, где он находится). Внешний ключ нужно индексировать явно!! Интересно, что внешний ключ в огромной таблице может ссылаться на маленькую. В таком случае селективность будет очень высокая, по очевидным причинам. 

Стоит учитывать, что индекс не соотносится с преобразованным столбцом. Например, индекс, построенный по column нельзя использовать на lower(column), т.к. нет привязанных значений для B-дерева (например). Но можно использовать функциональный индекс - это тоже самое, но при создании индекса к столбцу column применяется какая-либо функция, в нашем случае lower(column). 

Особое внимание следует обратить на даты и приведение их к какому-либо виду через синтаксис :: (например, upload_time::date >= current_date). Здесь приведение к ::date также отключает возможность использовать индекс. 

Оператор LIKE не работает с B-деревьями. 

Как определить какие индексы только занимают место? Системное представление pg_stat_all_indexes показывает статистику использования индекса с момента последнего сброса статистики. Стоит отметить, что некоторые индексы первичного ключа ***никогда*** не используются для поиска, но они жизненно необходимы для целостности данных и не должны удаляться. 

Со временем, при вводе в эксплуатацию, эффективность индекса может меняться. Например, может измениться уровень селективности. Или индекс перестанет помещаться в оперативную память. Или индекс начнет вытесняться индексами конкурирующих запросов. Все это может привести к увеличению времени поиска. 
___
Links: [[SQL]]
Tags: #разработка #программирование 
References: [[Оптимизация запросов PostgreSQL]]