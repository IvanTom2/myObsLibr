`asycnio.Task` в результате работы может получить два результата работы:
1. Какое-либо значение, которое определяет задачу как полную.
2. Какое-либо исключение, которое возбуждается при последующем обращении к задаче. 

В случае, если возникает исключение во время выполнения задачи, ***точка возбуждения исключения*** будет находиться в `await` соответствующей задачи. 
Тем не менее, могут возникать следующие проблемы:
1. Задача запускается и экземпляр задачи не используется в коде после запуска. В таком случае будет возбуждено исключение на уровне сопрограммы. 
2. Задача запускается, экземпляр задачи помещается в массив. В таком случае, экземпляр задачи будет иметь значение исключения. Также экземпляр задачи не будет удален сборщиком мусора, так как находится в массиве - при условии, что массив используется далее в коде. В результате этого может возникнуть ситуация, когда ***исключение никак не обработано и не возбуждено, но оно существует***. Это может повлиять на дальнейшую работу всего цикла событий. Стоит отметить, что ***исключение будет возбуждаться при любом обращении к задаче***.  
3. Тоже самое поведение, что в и пункте 2 проявляется если задача была создана итератором и собрана через `asyncio.gather`, но сам `asyncio.gather` никогда не ожидался. Возбуждение не будет возбуждено, но оно будет существовать. 

***Что делать?***
1. Ожидать все задачи через `await` - в таком случае исключение будет возбуждено, если не предусмотрена обработка исключения. 
2. Предусматривать обработку исключений в сопрограммах. В таком случае исключения будут обрабатывать. Стоит учесть момент, что после обработки исключения ожидаемый результат работы задачи может либо не вернуться (вернется ничего), либо вернется искаженное значение. 

___
```
import logging

async def echo(connection: socket,
	loop: AbstractEventLoop) -> None:
	
	try:
		while data := await loop.sock_recv(connection, 1024):
			print('получены данные!')
			if data == b'boom\r\n':
				raise Exception("Неожиданная ошибка сети")
		await loop.sock_sendall(connection, data)
	
	except Exception as ex:
		logging.exception(ex)
	
	finally:
		connection.close()
	
```
___

Relations: [[asyncio Python]] [[Асинхронные задачи asyncio Python]] 
Tags: #code
References: 
Query: 